<section class="max-w-[var(--container)] mx-auto px-4 py-14 space-y-10" id="timer">
    <!-- HEADER -->
    <header class="text-center">
        <div class="flex items-center justify-center gap-4">
            <span class="hidden sm:block h-px w-[60px] bg-[var(--c-primary)]"></span>
            <span class="font-['Montserrat'] text-[40px] leading-[75px] text-[var(--c-primary)]">
                {{ t('home.timer.title_mini') }}
            </span>
            <span class="hidden sm:block h-px w-[60px] bg-[var(--c-primary)]"></span>
        </div>
        <h2
            class="font-['Montserrat'] text-[clamp(28px,4vw,50px)] leading-[1.22] font-medium mt-1 text-center text-[#1E1E1E]">
            {{ t('home.timer.title_main') }}
        </h2>
    </header>

    {# Safe request.state.site -> _site, no hasattr #}
    {% set _state = (request.state if (request is defined and request and request.state is defined) else none) %}
    {% set _site = (_state.site if (_state is not none and _state.site is defined and _state.site) else none) %}

    <!-- One Alpine instance drives BOTH -->
    <div x-data='window.timerWidget({
        apiBase: "{{ settings.BACKEND_BASE_URL }}",
        bgUrl: "{{ url_for("static", path="img/timer/timer_bg.png") }}",
        logoUrl: "{{ url_for("static", path="img/timer/logo.png") }}",
        site: {{ (site_slug() if site_slug is defined else none) | tojson }},
        siteId: {{ (_site.id if (_site is not none and _site.id is defined and _site.id) else none) | tojson }}
      })' x-init='$nextTick(() => { if (typeof init === "function") init(); })'>


        <!-- ===== BIG TIMER (>=1024px) ===== -->
        <div class="timer-big flex w-full justify-center" x-show="isDesktop" x-cloak
            x-transition.opacity.duration.200ms>
            <div class="timer-wrap w-[1100px] xl:w-[1450px] h-[380px] xl:h-[460px]">
                <!-- Background -->
                <div class="timer-bg">
                    <img src="{{ url_for('static', path='img/timer/timer_bg.png') }}" x-bind:src="bgUrl" alt=""
                        aria-hidden="true" />
                </div>

                <!-- Overlay -->
                <div class="timer-overlay"></div>

                <!-- Optional darker left panel -->
                <div class="timer-left-panel w-[480px] xl:w-[564px] bg-black/30 backdrop-blur-[2.5px] rounded-l-[20px]">
                </div>

                <!-- Content ON TOP -->
                <div class="timer-content text-white">
                    <!-- Left content -->
                    <div class="absolute left-0 top-0 h-full w-[480px] xl:w-[564px]">
                        <div class="pl-[24px] pr-[20px] pt-[16px] flex items-center gap-3 w-full">
                            <img :src="logoUrl" alt="logo" class="w-[72px] xl:w-[80px] h-auto shrink-0" />
                            <div x-data='{ defaultEvent: {{ t("home.timer.default_event")|tojson }} }'
                                x-text='eventName || defaultEvent'
                                class="timer-title font-['Montserrat'] font-medium text-[20px] xl:text-[22px] leading-[26px] xl:leading-[28px] text-white pr-1"
                                style="max-width: calc(100% - 72px - 12px - 24px - 20px)"></div>
                        </div>
                    </div>

                    <!-- Center bar -->
                    <div
                        class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[840px] h-[190px] xl:w-[922px] xl:h-[215px]">
                        <div class="w-full h-full bg-[#007A3D] rounded-[40px] flex items-center justify-center px-8">
                            <div class="flex items-center gap-[32px] xl:gap-[42px] text-white select-none">
                                <!-- DAYS -->
                                <div class="flex flex-col items-center">
                                    <div class="font-['Roboto'] font-semibold tabular-nums text-[92px] leading-[92px] xl:text-[110px] xl:leading-[110px]"
                                        x-text="dd">00</div>
                                    <div
                                        class="mt-1 font-['Roboto'] text-[18px] leading-[22px] xl:text-[20px] xl:leading-[24px]">
                                        {{ t('home.timer.days')|upper }}</div>
                                </div>
                                <!-- dots -->
                                <div class="flex flex-col items-center justify-center gap-[18px] xl:gap-[22px]">
                                    <span class="block w-4 h-4 rounded-full bg-white"></span>
                                    <span class="block w-4 h-4 rounded-full bg-white"></span>
                                </div>
                                <!-- HOURS -->
                                <div class="flex flex-col items-center">
                                    <div class="font-['Roboto'] font-semibold tabular-nums text-[92px] leading-[92px] xl:text-[110px] xl:leading-[110px]"
                                        x-text="hh">00</div>
                                    <div
                                        class="mt-1 font-['Roboto'] text-[18px] leading-[22px] xl:text-[20px] xl:leading-[24px]">
                                        {{ t('home.timer.hours')|upper }}</div>
                                </div>
                                <!-- dots -->
                                <div class="flex flex-col items-center justify-center gap-[18px] xl:gap-[22px]">
                                    <span class="block w-4 h-4 rounded-full bg-white"></span>
                                    <span class="block w-4 h-4 rounded-full bg-white"></span>
                                </div>
                                <!-- MINUTES -->
                                <div class="flex flex-col items-center">
                                    <div class="font-['Roboto'] font-semibold tabular-nums text-[92px] leading-[92px] xl:text-[110px] xl:leading-[110px]"
                                        x-text="mm">00</div>
                                    <div
                                        class="mt-1 font-['Roboto'] text-[18px] leading-[22px] xl:text-[20px] xl:leading-[24px]">
                                        {{ t('home.timer.minutes')|upper }}</div>
                                </div>
                                <!-- dots -->
                                <div class="flex flex-col items-center justify-center gap-[18px] xl:gap-[22px]">
                                    <span class="block w-4 h-4 rounded-full bg-white"></span>
                                    <span class="block w-4 h-4 rounded-full bg-white"></span>
                                </div>
                                <!-- SECONDS -->
                                <div class="flex flex-col items-center">
                                    <div class="font-['Roboto'] font-semibold tabular-nums text-[92px] leading-[92px] xl:text-[110px] xl:leading-[110px]"
                                        x-text="ss">00</div>
                                    <div
                                        class="mt-1 font-['Roboto'] text-[18px] leading-[22px] xl:text-[20px] xl:leading-[24px]">
                                        {{ t('home.timer.seconds')|upper }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div><!-- /timer-content -->
            </div><!-- /timer-wrap -->
        </div>
        <!-- ===== SMALL (<1024px) redesigned ===== -->
        <div class="timer-small block w-full" x-show="!isDesktop" x-cloak x-transition.opacity.duration.200ms>
            <div class="relative mx-auto w-full max-w-[360px] h-[140px] rounded-[10px] overflow-hidden">

                <div class="absolute inset-0 z-0">
                    <img src="{{ url_for('static', path='img/timer/timer_bg.png') }}" x-bind:src="bgUrl" alt=""
                        aria-hidden="true" class="w-full h-full object-cover block" />
                </div>

                <div class="absolute inset-0 bg-black/35 z-0"></div>

                <div class="absolute top-2 left-4 z-10 select-none text-[#F0F0F0]">
                    <div class="font-['Montserrat'] font-medium text-[15px] leading-[1.1]">
                        {{ t('home.timer.remaining') }}
                    </div>
                </div>

                <div
                    class="absolute inset-0 z-10 text-[#F0F0F0] px-4 pt-6 pb-2 flex items-center justify-between select-none">

                    <div class="flex justify-center items-center gap-2">
                        <div class="text-center">
                            <div class="font-['Montserrat'] text-[40px] " x-text="dd">00</div>
                            <div class="font-['Lato','Roboto'] text-[15px] leading-[14px] opacity-80">
                                {{ t('home.timer.days')|upper }}
                            </div>
                        </div>

                        <span class="font-['Roboto'] font-semibold text-[25px] leading-[20px] pb-3">:</span>

                        <div class="text-center">
                            <div class="font-['Montserrat'] text-[40px] " x-text="hh">00</div>
                            <div class="font-['Lato','Roboto'] text-[15px] leading-[14px] opacity-80">
                                {{ t('home.timer.hours')|upper }}
                            </div>
                        </div>

                        <span class="font-['Roboto'] font-semibold text-[25px] leading-[20px] pb-3">:</span>

                        <div class="text-center">
                            <div class="font-['Montserrat'] text-[40px] " x-text="mm">00</div>
                            <div class="font-['Lato','Roboto'] text-[15px] leading-[14px] opacity-80">
                                {{ t('home.timer.minutes')|upper }}
                            </div>
                        </div>
                    </div>

                    <div class="text-center flex flex-col items-center justify-center">
                        <div class="font-['Montserrat'] font-medium text-[12px] leading-[1.2] opacity-90">
                            {{ t('home.timer.deadline') }}
                        </div>
                        <div class="font-['Montserrat'] text-[40px] "
                            x-text="deadlineDay || {{ timer.deadline_day|default(0) }}">
                            {{ timer.deadline_day }}
                        </div>
                        <div class="font-['Lato','Roboto'] text-[15px] leading-[14px] uppercase tracking-wider"
                            x-text="deadlineMonthUpper || {{ timer.deadline_month_upper|tojson }}">
                            {{ timer.deadline_month_upper }}
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>
</section>