{# Site-B: single-bar header with inline nav (no navpill) #}
{% set _req = request if request is defined else None %}
{% set _path = _req.url.path if _req else '/' %}
{% set _params = _req.query_params if _req else {} %}
{% set current = (lang or 'en') %}

<header id="site-header" class="sb-detailbar shadow-soft">
    <div class="sb-bar-inner">
        <!-- Left: Logo -->
        <a href="/" class="sb-logo" aria-label="Home">
            <img src="{{ theme('img/detailbar/logo.svg') }}" alt="" class="sb-logo-img"
                onerror="this.style.display='none'">
        </a>

        <!-- Center: Inline Nav -->
        <nav class="sb-navWrap">
            <ul class="sb-nav">
                <li><a href="/">{{ t('nav.home') }}</a></li>

                <li class="sb-has-dd" x-data="{m:false}" @mouseenter="m=true" @mouseleave="m=false">
                    <button type="button" class="sb-nav-btn" @click.stop="m=!m" aria-haspopup="menu"
                        :aria-expanded="m.toString()">
                        {{ t('nav.about_event') }}
                        <svg class="sb-caret" viewBox="0 0 12 8" aria-hidden="true">
                            <path d="M1 1l5 6 5-6" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                    <div class="sb-dd" x-cloak x-show="m" x-transition @click.outside="m=false"
                        @keydown.escape.window="m=false" role="menu">
                        <a href="/about-the-forum" class="sb-dd-item">{{ t('nav.about_forum') }}</a>
                        <hr class="sb-dd-sep" />
                        <a href="/agenda" class="sb-dd-item">{{ t('nav.agenda') }}</a>
                        <a href="/speakers" class="sb-dd-item">{{ t('nav.speakers') }}</a>
                        <a href="/meeting-request" class="sb-dd-item">{{ t('nav.meeting_request') }}</a>
                        <hr class="sb-dd-sep" />
                        <a href="/about-the-expo" class="sb-dd-item">{{ t('nav.about_expo') }}</a>
                        <hr class="sb-dd-sep" />
                        <a href="/official-support" class="sb-dd-item">{{ t('nav.official_support') }}</a>
                        <hr class="sb-dd-sep" />
                        <a href="/brochure" class="sb-dd-item">{{ t('nav.brochure') }}</a>
                    </div>
                </li>

                <li class="sb-has-dd" x-data="{m:false}" @mouseenter="m=true" @mouseleave="m=false">
                    <button type="button" class="sb-nav-btn" @click.stop="m=!m" aria-haspopup="menu"
                        :aria-expanded="m.toString()">
                        {{ t('nav.participants') }}
                        <svg class="sb-caret" viewBox="0 0 12 8" aria-hidden="true">
                            <path d="M1 1l5 6 5-6" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                    <div class="sb-dd" x-cloak x-show="m" x-transition @click.outside="m=false"
                        @keydown.escape.window="m=false" role="menu">
                        <a href="/participants" class="sb-dd-item">{{ t('nav.all') }}</a>
                        <hr class="sb-dd-sep" />
                        <a href="/participants?role=expo" class="sb-dd-item">{{ t('nav.expo') }}</a>
                        <hr class="sb-dd-sep" />
                        <a href="/participants?role=forum" class="sb-dd-item">{{ t('nav.forum') }}</a>
                    </div>
                </li>

                <li><a href="/news">{{ t('nav.news') }}</a></li>

                <li class="sb-has-dd" x-data="{m:false}" @mouseenter="m=true" @mouseleave="m=false">
                    <button type="button" class="sb-nav-btn" @click.stop="m=!m" aria-haspopup="menu"
                        :aria-expanded="m.toString()">
                        {{ t('nav.travel_guide') }}
                        <svg class="sb-caret" viewBox="0 0 12 8" aria-hidden="true">
                            <path d="M1 1l5 6 5-6" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                    <div class="sb-dd" x-cloak x-show="m" x-transition @click.outside="m=false"
                        @keydown.escape.window="m=false" role="menu">
                        <a href="/visa" class="sb-dd-item">{{ t('nav.apply_visa') }}</a>
                        <hr class="sb-dd-sep" />
                        <a href="/hotel" class="sb-dd-item">{{ t('nav.book_hotel') }}</a>
                        <hr class="sb-dd-sep" />
                        <a href="/flight" class="sb-dd-item">{{ t('nav.book_flight') }}</a>
                        <hr class="sb-dd-sep" />
                        <a href="/faq" class="sb-dd-item">{{ t('nav.faq') }}</a>
                    </div>
                </li>

                <li><a href="/registration">{{ t('nav.registration') }}</a></li>
            </ul>
        </nav>

        <!-- Right: user + language -->
        <div class="sb-right">
            <a href="/register" aria-label="Register" class="sb-user">
                <img class="sb-user-img" src="{{ theme('img/detailbar/user.svg') }}"
                    onerror="this.src='{{ url_for('static', path='/img/detailbar/ic-user.svg') }}'">
            </a>
            <div class="sb-lang" x-data="siteBLangMenu()" @keydown.escape.window="close()" @click.outside="close()">
                <button x-ref="btn" type="button" class="sb-lang-btn" :aria-expanded="open.toString()"
                    aria-haspopup="menu" aria-controls="lang-menu" @click="toggle()">
                    <span class="sb-lang-code">{{ current|upper }}</span>
                    <svg class="sb-lang-caret" viewBox="0 0 10 7" aria-hidden="true">
                        <path d="M1 1l4 5 4-5" fill="none" stroke="#F0F0F0" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>

                <div id="lang-menu" class="sb-lang-menu" x-cloak x-show="open" x-transition
                    :style="{ minWidth: (btnW || 0) + 'px' }" role="menu">
                    {% for code in ['en','ru','tk','zh'] %}
                    {% if code == current %}
                    <span class="sb-lang-item is-current" aria-current="true">{{ code|upper }}</span>
                    {% else %}
                    <a class="sb-lang-item"
                        href="{{ _path }}?lang={{ code }}{% for k,v in _params.items() if k!='lang' %}&{{k}}={{ v|urlencode }}{% endfor %}"
                        role="menuitem">{{ code|upper }}</a>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

</header>
<script>
    window.siteBLangMenu = function () {
        return {
            open: false,
            btnW: 0,
            toggle: function () {
                this.open = !this.open;
                this.$nextTick(() => {
                    var el = this.$refs.btn;
                    this.btnW = (el && el.offsetWidth) || 0;
                });
            },
            close: function () { this.open = false; },
            init: function () {
                var set = () => {
                    var el = this.$refs.btn;
                    this.btnW = (el && el.offsetWidth) || 0;
                };
                set();
                window.addEventListener('resize', set);
            }
        };
    };
</script>