{# safe fallbacks when this partial is included without locals #}
{% set _req = request if request is defined else None %}
{% set _path = _path if _path is defined else (_req.url.path if _req else '/') %}
{% set _params = _params if _params is defined else (_req.query_params if _req else {}) %}

<header id="site-header" class="detailbar relative z-detail" x-data="{ langOpen:false, mobileOpen:false }">
    <div class="max-w-[var(--container)] mx-auto px-4 row flex items-center justify-between gap-2 sm:gap-4">
        <!-- left: logo -->
        <div class="flex items-center">
            <a href="/" aria-label="Home" class="inline-flex items-center hover:opacity-90 transition">
                <img src="/static/img/detailbar/logo.svg" alt="Logo" class="h-7 w-auto md:h-8" />
            </a>
        </div>

        <!-- right: email + phone + lang + user -->
        <div class="flex items-center gap-3 sm:gap-4 md:gap-6 min-w-0">

            <!-- email -->
            <div class="group flex items-center gap-2 sm:gap-3 min-w-0 max-w-[38vw] sm:max-w-none">
                <img src="/static/img/detailbar/ic-mail.svg"
                    class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 transition-opacity group-hover:opacity-80" alt="" />
                <a href="mailto:info@ciet-turkmenistan.com" class="font-['Roboto'] font-medium text-[12px] sm:text-[16px] md:text-[20px] lg:text-[24px] truncate
                transition-colors hover:text-[#00B374] " title="info@ciet-turkmenistan.com">
                    info@ciet-turkmenistan.com
                </a>
            </div>

            <!-- phone -->
            <div class="group flex items-center gap-2 sm:gap-2.5">
                <img src="/static/img/detailbar/ic-phone.svg"
                    class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 transition-opacity group-hover:opacity-80" alt="" />
                <a href="tel:+99361480080" class="font-['Roboto'] font-medium text-[12px] sm:text-[16px] md:text-[20px] lg:text-[24px]
                transition-colors hover:text-[#00B374] ">
                    +99361 480 080
                </a>
            </div>

            <!-- language switcher -->
            <div class="relative" x-data="{open:false}" @mouseenter="open=true" @mouseleave="open=false">
                <button type="button" class="flex items-center gap-1 font-['Roboto'] font-medium px-1
                 text-[12px] sm:text-[16px] md:text-[20px] lg:text-[24px] rounded-md
                 hover:bg-white/10 transition-colors" aria-haspopup="true" @click="open=!open"
                    @keydown.escape.window="open=false">
                    {{ (lang or 'en')|upper }}
                    <svg class="w-3 h-3 sm:w-4 sm:h-4 -rotate-90 transition-transform" :class="open ? 'rotate-0' : ''"
                        viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M6 9l6 6 6-6" stroke="#F4F4F2" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>

                <!-- dropdown -->
                <div x-show="open" x-cloak x-transition
                    class="absolute right-0 top-full mt-2 w-24 p-2 glass text-white text-center z-[70]"
                    @click.away="open=false">
                    {% set current = (lang or 'en') %}
                    {% for code in ['en','ru','tk','zh'] if code != current %}
                    <a class="block py-2 rounded-md font-medium transition hover:bg-white/10"
                        href="{{ _path }}?lang={{ code }}{% for k,v in _params.items() if k!='lang' %}&{{k}}={{ v|urlencode }}{% endfor %}">
                        {{ code|upper }}
                    </a>
                    {% endfor %}
                </div>
            </div>



            <!-- user -->
            <a href="/register" aria-label="Register" class="   shrink-0 inline-flex hover:opacity-90 transition">
                <img src="/static/img/detailbar/ic-user.svg"
                    class=" w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 rounded-md  hover:bg-white/10" alt="User" />
            </a>
        </div>
    </div>



    <!-- NavPill -->
    {% set p = request.url.path %}
    <div class="pill-rail">
        <nav class="navpill  px-4 md:px-6">
            <ul
                class="flex flex-wrap items-center gap-3 md:gap-6 font-['Roboto'] font-bold text-[14px] sm:text-[16px] md:text-[18px] lg:text-[22px] xl:text-[22px text-[var(--c-primary)]">
                <li>
                    <a class="{{ 'hover:text-[var(--c-text)]' }}" href="/">{{ t('nav.home') }}</a>
                </li>

                <li class="relative" x-data="{m:false}" @mouseenter="m=true" @mouseleave="m=false">
                    <button class="flex items-center gap-2 hover:text-[var(--c-text)]">
                        {{ t('nav.about_forum') }} <span class="text-[var(--c-text)]/40">›</span>
                    </button>
                    <div x-show="m" x-cloak x-transition class="menu-dd">
                        <div class="glass menu-panel menu-grid">
                            <div class="menu-items relative" x-data="{open:false}" @mouseenter="open=true"
                                @mouseleave="open=false">
                                <a href="/about-the-forum" class="menu-item">
                                    <span>{{ t('nav.forum') }}</span>
                                    <span class="menu-items-arrow" aria-hidden="true"></span>
                                </a>
                                <div x-show="open" x-cloak x-transition.opacity class="menu-subcard">
                                    <a href="/agenda" class="menu-items-item menu-subitem">{{ t('nav.agenda') }}</a>
                                    <a href="/speakers" class="menu-items-item menu-subitem">{{ t('nav.speakers') }}</a>
                                    <a href="/meeting-request" class="menu-items-item menu-subitem">{{
                                        t('nav.meeting_request') }}</a>
                                </div>
                            </div>
                            <hr class="menu-sep" />
                            <a href="/about-the-expo" class="menu-item">{{ t('nav.about_expo') }}</a>
                            <hr class="menu-sep" />
                            <a href="/official-support" class="menu-item">{{ t('nav.official_support') }}</a>
                            <hr class="menu-sep" />
                            <a href="/brochure" class="menu-item">{{ t('nav.brochure') }}</a>
                        </div>
                    </div>
                </li>

                <li class="relative" x-data="{m:false}" @mouseenter="m=true" @mouseleave="m=false">
                    <button class="flex items-center gap-2 hover:text-[var(--c-text)]">
                        {{ t('nav.participants') }} <span class="text-[var(--c-text)]/40">›</span>
                    </button>
                    <div x-show="m" x-cloak x-transition class="menu-dd">
                        <div class="glass menu-panel">
                            <a href="/participants{% if q %}?q={{ q|urlencode }}{% endif %}" class="menu-item">{{
                                t('nav.all') }}</a>
                            <hr class="menu-sep" />
                            <a href="/participants?role=expo{% if q %}&q={{ q|urlencode }}{% endif %}"
                                class="menu-item">{{ t('nav.expo') }}</a>
                            <hr class="menu-sep" />
                            <a href="/participants?role=forum{% if q %}&q={{ q|urlencode }}{% endif %}"
                                class="menu-item">{{ t('nav.forum') }}</a>
                        </div>
                    </div>
                </li>

                <li>
                    <a href="/news"
                        class="{{ 'text-[var(--c-text)]' if p.startswith('/news') else 'hover:text-[var(--c-text)]' }}">{{
                        t('nav.news') }}</a>
                </li>

                <li class="relative" x-data="{m:false}" @mouseenter="m=true" @mouseleave="m=false">
                    <button class="flex items-center gap-2 hover:text-[var(--c-text)]">
                        {{ t('nav.travel_guide') }} <span class="text-[var(--c-text)]/40">›</span>
                    </button>
                    <div x-show="m" x-cloak x-transition class="menu-dd">
                        <div class="glass menu-panel">
                            <a href="/visa" class="menu-item">{{ t('nav.apply_visa') }}</a>
                            <hr class="menu-sep" />
                            <a href="/hotel" class="menu-item">{{ t('nav.book_hotel') }}</a>
                            <hr class="menu-sep" />
                            <a href="/flight" class="menu-item">{{ t('nav.book_flight') }}</a>
                            <hr class="menu-sep" />
                            <a href="/faq" class="menu-item">{{ t('nav.faq') }}</a>
                        </div>
                    </div>
                </li>

                <li>
                    <a href="/registration"
                        class="{{ 'text-[var(--c-text)]' if p.startswith('/registration') else 'hover:text-[var(--c-text)]' }}">{{
                        t('nav.registration') }}</a>
                </li>

            </ul>
        </nav>
    </div>
</header>